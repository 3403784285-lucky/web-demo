<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>音乐播放器</title>
    <link rel="stylesheet" href="css/header.css">
    <link rel="stylesheet" href="css/left.css">
    <link rel="stylesheet" href="css/edit.css">
    <link rel="stylesheet" href="css/footer.css">
    <link rel="stylesheet" href="http://at.alicdn.com/t/c/font_4248113_ox2f1wjcyl.css">

</head>
<body>

<div class="container">
    <div class="container-head">
        <div class="topbar">
            <div class="topbar-item">
                <div class="mark">
                    <i class="iconfont icon-icon-spring-pink"></i>
                    <span>海棠花开</span>
                </div>
                <div>
                    <a href="javascript:window.history.back()" id="prePage" class="pre-page iconfont icon-fanhui"></a>

                </div>

                <div class="topbar-right-search">
                    <input type="text" placeholder="搜索">
                    <i class="iconfont icon-sousuo">
                    </i>
                </div>
                <div class="person">
                    <div class="image"><img id="avatar"/></div>
                    <a class="information" href="person.html">未登录</a>
                </div>
            </div>
        </div>
        <div class="main">
            <div class="main-left">
                <div class="item-left">
                    <!-- 列表标签 -->
                    <ul>
                        <li>
                            <div class="music-title">发现音乐</div>
                            <ul class="main-left-subnav">
                                <li>
                                    <a href="music.html" >
                                        <i class="iconfont icon-remen"></i>
                                        <span>热门推荐</span>
                                    </a>

                                </li>

                                <li>
                                    <a href="rankList.html">
                                        <i class="iconfont icon-yinleliebiao"></i>
                                        <span>新歌排行榜</span>
                                    </a>

                                </li>
                            </ul>
                        </li>
                        <li>
                            <div class="music-title">我的音乐</div>

                            <ul class="main-left-subnav">
                                <li>
                                    <a href="like.html" >
                                        <i class="iconfont icon-xihuan"></i>
                                        <span>我喜欢的音乐</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="load.html">
                                        <i class="iconfont icon-xiazai"></i>
                                        <span>本地与下载</span>
                                    </a>

                                </li>
                                <li>
                                    <a href="collect.html">
                                        <i class="iconfont icon-ego-favorite"></i>
                                        <span>我的收藏</span>
                                    </a>

                                </li>
                                <li>
                                    <a href="identify.html">
                                        <i class="iconfont icon-OTCrenzheng"></i>
                                        <span>歌手认证</span>
                                    </a>

                                </li>


                            </ul>
                        </li>
                        <li>
                            <div class="music-title">我的歌单</div>

                            <ul class="main-left-subnav">
                                <li>
                                    <a href="editplaylist.html" >
                                        <i class="iconfont icon-chuangjiangedan"></i>
                                        <span>创建歌单</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="person.html">
                                        <i class="iconfont icon-gedanbiaoqian"></i>
                                        <span>歌单合集</span>
                                    </a>

                                </li>



                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="main-right">
                <div class="title">编辑个人信息</div>
                <div class="modify">
                    <div class="modify-field">
                        <div class="nickname part">
                            <div class="part-header">昵称：</div>
                            <input class="name-content" type="text">
                        </div>
                        <div class="introduction part">
                            <div class="part-header">介绍：</div>
                            <textarea class="introduction-content" rows="4" cols="20"></textarea>
                        </div>
                        <div class="gender part">
                            <div class="part-header">性别：</div>
                            <input type="radio" class="man" name="gender">&nbsp男
                            <input type="radio" class="woman" name="gender">&nbsp女
                        </div>
                        <div class="birthday part">
                            <div class="part-header">生日：</div>
                            <input type="date" class="birthday-content">

                        </div>
                        <div class="button part">
                            <div class="submit-button">&nbsp&nbsp&nbsp&nbsp保存</div>
                            <div class="cancel-button">&nbsp&nbsp&nbsp&nbsp取消</div>
                        </div>


                    </div>
                    <div class="modify-image" >
                        <img class="avatar">
                        <div class="modify-button">&nbsp&nbsp&nbsp&nbsp修改头像</div>
                        <input  class="choose-image" type="file" name="image" accept="image/*">
                    </div>
                </div>

            </div>
        </div>

    </div>
    <footer>
        <div class="footer_list">
            <div class="footer-btn">
                <div class="iconfont">
                    <img  class="music-image"></img>
                </div>
                <ul><li class="china">未知</li></ul>

                <div class="play-part">
                    <div   class="like iconfont icon-jushoucang"></div>
                    <div  class="model iconfont icon-yinleliebiao"></div>
                    <div class="prev iconfont icon-shangyishou-yuanshijituantubiao"></div>
                    <div   id="player" class="pause iconfont icon-zanting"></div>
                    <!-- <a  href="#" class="play iconfont icon-suspend"></a> -->
                    <div   class="next iconfont icon-xiayishou-yuanshijituantubiao"></div>

                    <div id="controlVolume">
                        <div id="volumeBarBgBorder">
                            <div id="volumeBarBg">
                                <div id="volumeBar"></div>
                            </div>
                        </div>
                        <div  class="loudness iconfont icon-yinliang"></div>

                    </div>
                    <div  class="music-list iconfont icon-ks3_music"></div>

                    <audio>
                        <source  type="audio/mp3">
                    </audio>
                    <div class="audio-bottom">
                        <span class="audio-length-current" id="audioCurTime">00:00</span>
                        <div class="process-bar-bg" id="processBarBg">
                            <span id="processDot"></span>
                            <div class="process-bar" id="processBar"></div>
                        </div>
                        <span class="audio-length-total" id="totalTime">00:00</span>
                    </div>
                    <div class="music-frame">

                        <div class="music-broadcast" style="margin-left: 20px;margin-top: 20px;">
                            <div class="now-play" style="font-size: 20px;font-weight: bolder;margin-bottom: 20px;">
                                当前播放
                            </div>
                            <div style="display: flex; line-height: 20px;margin-bottom: 10px; ">
                                <div style="font-size: 13px;color: #a6b0ba; margin-right: 250px;" >
                                    总共35首
                                </div>
                                <div class="delete-table" style="color: #7ba4ac;font-size: 15px;cursor: pointer;">
                                    清空列表
                                </div>
                            </div>
                            <div style="height: 1px;width: 100%;background: #d0d5ca;margin-bottom: 10px;">

                            </div>
                            <ul id="musicListLi" style="overflow-y: scroll;">


                            </ul>

                        </div>


                    </div>


                </div>
            </div>
        </div>
    </footer>
</div>
<script type="text/javascript" src="./js/music.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
    let param = new URLSearchParams();
    param.append('refreshToken', localStorage.getItem('refreshToken'));
    param.append('accessToken', localStorage.getItem('accessToken'));
    axios.post("http://localhost:8080/web-demo/userCopy/userInfo",param).then(function (response) {
        var data=response.data;
        if(data=="fail")
        {

        }
        else
        {
            var image=document.getElementById('avatar');
            var img=document.getElementsByClassName('avatar')[0];
            var name=document.getElementsByClassName('name-content')[0];
            var nameCopy=document.getElementsByClassName('information')[0];
            var woman=document.getElementsByClassName('woman')[0];
            var man=document.getElementsByClassName('man')[0];
            var birthday=document.getElementsByClassName('birthday-content')[0];
            var signature=document.getElementsByClassName('introduction-content')[0];
            image.src=data["image"];
            img.src=data["image"];
            name.value=data["name"];
            nameCopy.innerHTML=data["name"];
            birthday.value=data["birthday"];
            if (data["gender"]=='2')
            {
                man.checked=true;
            }
            else
            {
                woman.checked=true;
            }
            signature.innerHTML=data["signature"];
            localStorage.setItem("refreshToken",data["refreshToken"]);
            localStorage.setItem("accessToken",data["accessToken"]);
        }



    }).catch(function(error) {
        // 请求失败，提示错误信息
        console.error(error);
    });
    var cancel=document.getElementsByClassName('cancel-button')[0];
    var formElements=document.querySelectorAll('textarea,input,radio');
    var buttonSubmit=document.getElementsByClassName('submit-button')[0];
    buttonSubmit.disabled=true;
    formElements.forEach((element)=>
    {
        element.addEventListener('change',(event)=>
        {
            buttonSubmit.disabled=false;
        });
    });
    // 要获取input里面的值用value好一点
    cancel.addEventListener('click',()=>
    {
        window.location.href = '/web-demo/person.html';
    })
    buttonSubmit.addEventListener('click',()=>
    {
        var img=document.getElementsByClassName('avatar')[0].src;
        var name=document.getElementsByClassName('name-content')[0].value;
        var woman=document.getElementsByClassName('woman')[0];
        var signature=document.getElementsByClassName('introduction-content')[0].value;
        var birthday=document.getElementsByClassName('birthday-content')[0].value;
        let paramCopy = new URLSearchParams();
        paramCopy.append('image', img);
        paramCopy.append('name', name);
        if(woman.checked)
        {
            paramCopy.append('gender','1');
        }
        else
        {
            paramCopy.append('gender','2');
        }
        paramCopy.append('signature',signature);
        paramCopy.append('birthday',birthday);
        paramCopy.append('refreshToken', localStorage.getItem('refreshToken'));
        paramCopy.append('accessToken', localStorage.getItem('accessToken'));


        axios.post("http://localhost:8080/web-demo/userCopy/editInfo",paramCopy).then(function (response) {
            var data=response.data;
             if(response.data=="fail")
             {
                 //跳到登陆界面
                 alert("个人信息保存失败");
                 window.location.href = '/web-demo/login.html';
             }
             else
             {
                 alert("个人信息保存成功");
                 localStorage.setItem('image',data["image"]);
                 localStorage.setItem('name',data["name"]);
                 localStorage.setItem("refreshToken",data["refreshToken"]);
                 localStorage.setItem("accessToken",data["accessToken"]);
                 window.location.href = '/web-demo/person.html';
             }
         });
    });
    var chooseImage=document.getElementsByClassName('choose-image')[0];
    var modifyButton=document.getElementsByClassName('modify-button')[0];
    modifyButton.addEventListener('click',function()
    {
        chooseImage.click();
    })
    chooseImage.addEventListener('change',function ()
    {
        const file = chooseImage.files[0];
        //这就是文件路径
        const filePath = URL.createObjectURL(file);
        document.getElementsByClassName('image')[0].src=filePath;
        var avatar=document.getElementsByClassName('avatar')[0];
        avatar.src=filePath;

    })
</script>
</body>
</html>